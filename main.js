(()=>{"use strict";class e{constructor(){this.url="https://ahj-homeworks-helpdesk-server.onrender.com"}createForm(){const e=document.createElement("form");e.className="form hidden create_form",e.method="POST",e.action=this.url;const t=document.createElement("h3");t.className="form_title",t.textContent="Добавить тикет",e.appendChild(t);const n=document.createElement("div");n.className="form_body";const o=document.createElement("span");o.className="form_title_1",o.textContent="Кратное описание";const c=document.createElement("input");c.className="form_input_1",c.type="text";const s=document.createElement("span");s.className="form_title_2",s.textContent="Подробное описание";const a=document.createElement("textarea");a.className="form_input_2",a.rows="10",n.appendChild(o),n.appendChild(c),n.appendChild(s),n.appendChild(a),e.appendChild(n);const i=document.createElement("div");i.className="form_button";const r=document.createElement("button");r.className="form_btn_censel",r.textContent="Cansel";const d=document.createElement("button");d.className="form_btn_ok",d.textContent=" OK ",i.appendChild(r),i.appendChild(d),e.appendChild(i),document.querySelector(".mein").appendChild(e)}editForm(){const e=document.createElement("form");e.className="form hidden edit_form",e.method="POST",e.action=this.url;const t=document.createElement("h3");t.className="form_title",t.textContent="Изменить тикет",e.appendChild(t);const n=document.createElement("div");n.className="form_body";const o=document.createElement("span");o.className="form_title_1",o.textContent="Кратное описание";const c=document.createElement("input");c.className="form_input_1",c.type="text";const s=document.createElement("span");s.className="form_title_2",s.textContent="Подробное описание";const a=document.createElement("textarea");a.className="form_input_2",a.rows="10",n.appendChild(o),n.appendChild(c),n.appendChild(s),n.appendChild(a),e.appendChild(n);const i=document.createElement("div");i.className="form_button";const r=document.createElement("button");r.className="form_btn_censel",r.textContent="Cansel";const d=document.createElement("button");d.className="form_btn_ok",d.textContent=" OK ",i.appendChild(r),i.appendChild(d),e.appendChild(i),document.querySelector(".mein").appendChild(e)}}class t{constructor(e){let{id:t,name:n,description:o,status:c,created:s}=e;this.id=t,this.name=n,this.description=o,this.status=c,this.created=s}}class n{constructor(e,t,n,o,c){this.id=e,this.name=t,this.description=n,this.status=o,this.created=c}createTicket(e,t,n,o,c){const s=document.createElement("div");s.className="ticket_item",s.id=e;const a=document.createElement("div");a.className="ticket_item_head";const i=document.createElement("div");i.className="dot_status circle",i.style.background=o?"green":"red";const r=document.createElement("p");r.className="ticket_title",r.textContent=t;const d=document.createElement("span");d.className="ticket_data",d.textContent=`Date: ${this.formatDate(c)}`;const l=document.createElement("div");l.className="dot_edit circle";const m=document.createElement("div");m.className="dot_close circle";const u=document.createElement("span");u.className="dot_close_x",u.textContent="X",s.appendChild(a),a.appendChild(i),a.appendChild(r),a.appendChild(d),a.appendChild(l),m.appendChild(u),a.appendChild(m),document.querySelector(".ticket_list").appendChild(s)}formatDate(e){const t=new Date(e);return`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear().toString().slice(-2)}`}}const o=[];class c{constructor(){this.urlServer="https://ahj-homeworks-helpdesk-server.onrender.com/",this.urlLocal="http://localhost:7070/"}async list(){const e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&console.log(e.responseText)},e.open("GET",`${this.urlServer}?method=allTickets`),e.send(),e.addEventListener("load",(()=>{if(e.status>=200&&e.status<300)try{const t=JSON.parse(e.responseText);console.log(t);for(const e of t)o.push({id:e.id,name:e.name,description:e.description,status:e.status,created:e.created});t.forEach((e=>{(new n).createTicket(e.id,e.name,e.description,e.status,e.created)}))}catch(e){console.error(e)}}))}get(e){const t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&console.log(t.responseText)},t.open("GET",`${this.urlServer}?method=ticketById&id=${e}`),t.send(),t.addEventListener("load",(()=>{if(t.status>=200&&t.status<300)try{const e=JSON.parse(t.responseText);if(console.log(`полуичли data: ${e}`),e)return e;console.error("data JSON.parse is undefined or null")}catch(e){console.error(e)}return console.log("Не получили ошибку от 200 до 300")}))}create(e){const t=new XMLHttpRequest,c=JSON.stringify(e);console.log("Отправляемые данные:",c),t.open("POST",`${this.urlServer}?method=createTicket`),t.setRequestHeader("Content-type","application/json; charset=utf-8"),t.send(c),t.addEventListener("load",(()=>{if(t.status>=200&&t.status<300)try{const e=JSON.parse(t.responseText);console.log(`полуичли data: ${e}`),e?((new n).createTicket(e.id,e.name,e.description,e.status,e.created),o.push({id:e.id,name:e.name,description:e.description,status:e.status,created:e.created})):console.error("ticketData is undefined or null")}catch(e){console.error(e)}}))}update(e,t){const n=new XMLHttpRequest,o=JSON.stringify(t);console.log("Отправляемые данные:",o),n.open("POST",`${this.urlServer}?method=updateById&id=${e}`),n.setRequestHeader("Content-type","application/json; charset=utf-8"),n.send(o)}delete(e){console.log(`delete id ${e}`);const t=new XMLHttpRequest;t.onreadystatechange=function(){4===t.readyState&&console.log(t.responseText)},t.open("GET",`${this.urlServer}?method=deleteById&id=${e}`),t.send()}}class s{createPopDel(){const e=document.createElement("dev");e.className="pop_del hidden";const t=document.createElement("h3");t.className="pop_del_title",t.textContent="Удалить тикет",e.appendChild(t);const n=document.createElement("p");n.className="pop_paragraf",n.textContent="Вы уверены, что хотите удалить тикет? Это действие необратимо.",e.appendChild(n);const o=document.createElement("div");o.className="pop_button";const c=document.createElement("button");c.className="pop_btn_cansel",c.textContent="Cansel";const s=document.createElement("button");s.className="pop_btn_ok",s.textContent=" OK ",o.appendChild(c),o.appendChild(s),e.appendChild(o),document.querySelector(".mein").appendChild(e)}}const a=document.getElementById("root"),i=new c,r=new class{constructor(t,o){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.container=t,this.ticketService=o,this.ticketForm=new e,this.ticketView=new n,this.ticketService=new c,this.popUpDel=new s}init(){console.info("init"),this.ticketService.list(),this.ticketForm.createForm(),this.ticketForm.editForm(),this.popUpDel.createPopDel();const e=document.querySelector(".btn_add_ticket"),n=document.querySelector(".form_btn_censel"),c=document.querySelector(".create_form"),s=document.querySelector(".edit_form"),a=document.querySelector(".pop_del");e.addEventListener("click",(e=>{e.preventDefault(),c.classList.remove("hidden")})),n.addEventListener("click",(e=>{e.preventDefault(),c.classList.add("hidden"),c.querySelector(".form_input_1").value="",c.querySelector(".form_input_2").value=""})),c.addEventListener("submit",(e=>{e.preventDefault();const n=c.querySelector(".form_input_1"),o=c.querySelector(".form_input_2"),s=new t({id:null,name:n.value,description:o.value,status:!1,created:new Date});console.log(s),this.ticketService.create(s),c.classList.add("hidden"),n.value="",o.value=""})),document.body.addEventListener("click",(e=>{const t=e.target.classList.contains("dot_close"),n=e.target.classList.contains("dot_close_x"),c=e.target.closest(".ticket_item");if((n||t)&&c){console.log("click dot_close");const e=o.find((e=>e.id===c.id));e?(console.log("listItem ok"),a.classList.remove("hidden"),document.querySelector(".pop_btn_ok").addEventListener("click",(t=>{t.preventDefault(),this.ticketService.delete(e.id),c.remove(),a.classList.add("hidden")})),document.querySelector(".pop_btn_cansel").addEventListener("click",(e=>{e.preventDefault(),a.classList.add("hidden")}))):console.error("Ticket not found in the list.")}})),document.body.addEventListener("click",(e=>{const t=e.target.classList.contains("dot_edit"),n=e.target.closest(".ticket_item"),c=n?n.querySelector(".ticket_title"):null;if(t&&n){console.log("click dot_edit");const e=o.find((e=>e.id===n.id));if(e){s.classList.remove("hidden"),s.querySelector(".form_input_1").value=e.name,s.querySelector(".form_input_2").value=e.description;const t=s.querySelector(".form_btn_censel"),n=s.querySelector(".form_btn_ok");t.replaceWith(t.cloneNode(!0)),n.replaceWith(n.cloneNode(!0)),s.querySelector(".form_btn_censel").addEventListener("click",(e=>{e.preventDefault(),s.classList.add("hidden")})),s.querySelector(".form_btn_ok").addEventListener("click",(t=>{t.preventDefault(),e.name=s.querySelector(".form_input_1").value,c?c.textContent=e.name:console.error("ticketTitle не найден"),e.description=s.querySelector(".form_input_2").value,this.ticketService.update(e.id,e),s.classList.add("hidden")}))}else console.error("Ticket not found in the list.")}})),document.body.addEventListener("click",(e=>{const t=e.target.closest(".ticket_item");if(t){const n=e.target.classList.contains("ticket_title");if(e.target.classList.contains("ticket_item_head")||n){console.log("ticket_item height ON"),t.style.height="100px";const e=o.find((e=>e.id===t.id));let n=t.querySelector(".ticket_description");n||(n=document.createElement("span"),n.className="ticket_description",n.textContent=e.description,t.appendChild(n))}else console.log("ticket_item height OFF")}else{console.log("ticket_item height OFF");document.querySelectorAll(".ticket_item").forEach((e=>{e.style.height="53px";const t=e.querySelector(".ticket_description");t&&t.remove()}))}})),document.body.addEventListener("click",(e=>{if(e.target.classList.contains("dot_status")){const t=e.target.closest(".ticket_item"),n=o.find((e=>e.id===t.id)),c=t.querySelector(".dot_status");c&&(n.status?(n.status=!1,c.style.background="red",this.ticketService.update(n.id,n)):(n.status=!0,c.style.background="green",this.ticketService.update(n.id,n)))}}))}}(a,i);r.init()})();